apiVersion: v1
kind: ConfigMap
metadata:
  name: postgres-config
  namespace: amq-streams-cdc
  labels:
    app.kubernetes.io/part-of: amq-streams-cdc-demo
    app.kubernetes.io/component: postgres
data:
  init.sql: |
    -- Create the inventory database
    SELECT 'CREATE DATABASE inventory' WHERE NOT EXISTS (SELECT FROM pg_database WHERE datname = 'inventory')\gexec
    
    -- Connect to inventory and create the table
    \c inventory
    
    -- Create the target table for CDC data
    CREATE TABLE IF NOT EXISTS products (
        id INTEGER PRIMARY KEY,
        name VARCHAR(255) NOT NULL,
        description VARCHAR(512),
        weight DECIMAL(10,2),
        created_at TIMESTAMP,
        updated_at TIMESTAMP
    );
    
    -- Create index for better query performance
    CREATE INDEX IF NOT EXISTS idx_products_name ON products(name);

